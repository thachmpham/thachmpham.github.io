<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>GDB: Memory</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="/html/style/dark.css" />
  <!-- <script src="../3pp/d3.v7.js"></script> -->
  <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
      mermaid.initialize({
          theme: 'dark',
      });
  </script>
</head>
<body>
<header id="title-block-header">
<h1 class="title">GDB: Memory</h1>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#stack" id="toc-stack">1. Stack</a>
<ul>
<li><a href="#stack-pointer" id="toc-stack-pointer">1.1. Stack
Pointer</a>
<ul>
<li><a href="#push-pop" id="toc-push-pop">1.1.1. Push &amp; Pop</a></li>
<li><a href="#call-ret" id="toc-call-ret">1.1.2. Call &amp; Ret</a></li>
</ul></li>
<li><a href="#base-pointer" id="toc-base-pointer">1.2. Base Pointer</a>
<ul>
<li><a href="#prolog-epilog" id="toc-prolog-epilog">1.2.1. Prolog &amp;
Epilog</a></li>
<li><a href="#arguments-local-variables"
id="toc-arguments-local-variables">1.2.2. Arguments &amp; Local
Variables</a></li>
</ul></li>
<li><a href="#examine-stack-frame" id="toc-examine-stack-frame">1.3.
Examine Stack Frame</a></li>
</ul></li>
<li><a href="#gdb" id="toc-gdb">GDB</a>
<ul>
<li><a href="#find-memory" id="toc-find-memory">Find Memory</a></li>
<li><a href="#export-memory" id="toc-export-memory">Export
Memory</a></li>
<li><a href="#import-memory" id="toc-import-memory">Import
Memory</a></li>
<li><a href="#memory-regions" id="toc-memory-regions">Memory
Regions</a></li>
<li><a href="#core-dump" id="toc-core-dump">Core Dump</a></li>
</ul></li>
</ul>
</nav>
<h1 id="stack">1. Stack</h1>
<div class="columns">
<div class="column" style="width:33%;">
<p><strong>Definition</strong><br />
The stack is a per-thread memory region, meaning each thread has its own
stack that is not shared with others.</p>
</div><div class="column" style="width:33%;">
<p><strong>Movement</strong><br />
On each function call, the stack grows downward from high address to low
address. It shrinks when function returns</p>
</div><div class="column" style="width:33%;">
<p><strong>Contents</strong><br />
Stores local variables and saved registers, such as the previous %rbp,
and the return address (or the next instruction).</p>
</div>
</div>
<h2 id="stack-pointer">1.1. Stack Pointer</h2>
<p>The stack pointer (rsp) always points to the current top of the
stack. The push/pop, call/ret instructions will adjust %rsp.</p>
<h3 id="push-pop">1.1.1. Push &amp; Pop</h3>
<p>The push instruction put a value onto the stack. The pop instruction
remove a value from the stack. Register rsp automatically moves to the
top of the stack.</p>
<div class="columns">
<div class="column" style="width:40%;">
<p>File main.s</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>.<span class="bu">section</span> <span class="op">.</span>text</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>.global _start</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>.text</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">_start:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    movabs  <span class="op">$</span><span class="bn">0</span>xabcdabcdabcdabcd<span class="op">,</span> <span class="op">%</span><span class="kw">rax</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">push</span>    <span class="op">%</span><span class="kw">rax</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    movabs  <span class="op">$</span><span class="bn">0</span>x1234123412341234<span class="op">,</span> <span class="op">%</span><span class="kw">rax</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">push</span>    <span class="op">%</span><span class="kw">rax</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">movq</span>    <span class="op">$</span><span class="bn">60</span><span class="op">,</span> <span class="op">%</span><span class="kw">rax</span>     <span class="op">#</span> syscall<span class="op">:</span> exit</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    xorq    <span class="op">%</span><span class="kw">rdi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rdi</span>    <span class="op">#</span> exit code <span class="dv">0</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">syscall</span></span></code></pre></div>
<p>Build.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as</span> main.s <span class="at">-o</span> main.o</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ld</span> main.o <span class="at">-o</span> main</span></code></pre></div>
<p>Debug.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="fu">file</span> main</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">break</span> <span class="ex">_start</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">run</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> 1, 0x0000000000401000 in _start <span class="er">(</span><span class="kw">)</span></span></code></pre></div>
</div><div class="column" style="width:60%;">
<p>Monitor the stack through instructions.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">disassemble</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Dump</span> of assembler code for function _start:</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x0000000000401000 <span class="op">&lt;</span>+0<span class="op">&gt;</span>:     movabs <span class="va">$0</span>xabcdabcdabcdabcd,%rax</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040100a</span> <span class="op">&lt;</span>+10<span class="op">&gt;</span>:    push   %rax</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040100b</span> <span class="op">&lt;</span>+11<span class="op">&gt;</span>:    movabs <span class="va">$0</span>x1234123412341234,%rax</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000401015</span> <span class="op">&lt;</span>+21<span class="op">&gt;</span>:    push   %rax</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000401016</span> <span class="op">&lt;</span>+22<span class="op">&gt;</span>:    mov    <span class="va">$0</span>x3c,%rax</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040101d</span> <span class="op">&lt;</span>+29<span class="op">&gt;</span>:    xor    %rdi,%rdi</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000401020</span> <span class="op">&lt;</span>+32<span class="op">&gt;</span>:    syscall</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">while</span> <span class="ex">1</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> x/4gx <span class="va">$rsp</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> x/i <span class="va">$rip</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> nexti</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> end</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe700:</span> 0x0000000000000001      0x00007fffffffe9ab</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe710:</span> 0x0000000000000000      0x00007fffffffe9bc</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x401000 <span class="op">&lt;</span>_start<span class="op">&gt;</span>:   movabs <span class="va">$0</span>xabcdabcdabcdabcd,%rax</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x40100a <span class="op">&lt;</span>_start+10<span class="op">&gt;</span>:        push   %rax</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe6f8:</span> 0xabcdabcdabcdabcd      0x0000000000000001</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe708:</span> 0x00007fffffffe9ab      0x0000000000000000</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x40100b <span class="op">&lt;</span>_start+11<span class="op">&gt;</span>:        movabs <span class="va">$0</span>x1234123412341234,%rax</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x401015 <span class="op">&lt;</span>_start+21<span class="op">&gt;</span>:        push   %rax</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe6f0:</span> 0x1234123412341234      0xabcdabcdabcdabcd</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe700:</span> 0x0000000000000001      0x00007fffffffe9ab</span></code></pre></div>
</div>
</div>
<p>Changes of the stack.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>┌───────────────┬───────────────────┐        ┌───────────────┬───────────────────┐        ┌───────────────┬───────────────────┐</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>│   address     │       value       │        │   address     │       value       │        │   address     │       value       │</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>├───────────────┼───────────────────┤        ├───────────────┼───────────────────┤        ├───────────────┼───────────────────┤</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>│               │                   │        │               │                   │        │               │                   │</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>│               │                   │ push   │               │                   │ push   │<span class="bn">0x7fffffffe6f0</span> │ <span class="bn">0x1234123412341234</span>│</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>│               │                   │ ─────► │<span class="bn">0x7fffffffe6f8</span> │ <span class="bn">0xabcdabcdabcdabcd</span>│ ─────► │<span class="bn">0x7fffffffe6f8</span> │ <span class="bn">0xabcdabcdabcdabcd</span>│</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│        │<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│        │<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│        │<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│        │<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│        │<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│        │<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│        │<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│        │<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>└───────────────┴───────────────────┘        └───────────────┴───────────────────┘        └───────────────┴───────────────────┘</span></code></pre></div>
<h3 id="call-ret">1.1.2. Call &amp; Ret</h3>
<p>The call instruction pushes the address of the next instruction (rip)
onto the stack then jump to the target function. This address is also
called the return address.<br />
The ret instruction pops the return address from the stack and jump to
this address.</p>
<div class="columns">
<div class="column" style="width:40%;">
<p>File main.s</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>.<span class="bu">section</span> <span class="op">.</span>text</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>.global _start</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">_start:</span>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">mov</span>     <span class="op">$</span><span class="bn">5</span><span class="op">,</span> <span class="op">%</span><span class="kw">rdi</span>    <span class="op">#</span> x <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">mov</span>     <span class="op">$</span><span class="bn">7</span><span class="op">,</span> <span class="op">%</span><span class="kw">rsi</span>    <span class="op">#</span> y <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">call</span>    sum         <span class="op">#</span> sum<span class="op">(</span>x<span class="op">,</span> y<span class="op">)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">mov</span>     <span class="op">$</span><span class="bn">60</span><span class="op">,</span> <span class="op">%</span><span class="kw">rax</span>   <span class="op">#</span> syscall<span class="op">:</span> exit</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">xor</span>     <span class="op">%</span><span class="kw">rdi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rdi</span>  <span class="op">#</span> exit code <span class="dv">0</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">syscall</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a># <span class="bu">add</span> two integers</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sum:</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">add</span>     <span class="op">%</span><span class="kw">rsi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rdi</span>  <span class="op">#</span> x <span class="op">+=</span> y</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">mov</span>     <span class="op">%</span><span class="kw">rdi</span><span class="op">,</span> <span class="op">%</span><span class="kw">rax</span>  <span class="op">#</span> <span class="kw">rax</span> <span class="op">=</span> x</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">ret</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as</span> main.s <span class="at">-o</span> main.o</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ld</span> main.o <span class="at">-o</span> main</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="fu">file</span> main</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">break</span> <span class="ex">_start</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">run</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> 1, 0x0000000000401000 in _start <span class="er">(</span><span class="kw">)</span></span></code></pre></div>
</div><div class="column" style="width:60%;">
<p>Monitor the stack through instructions.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">disassemble</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Dump</span> of assembler code for function _start:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x0000000000401000 <span class="op">&lt;</span>+0<span class="op">&gt;</span>:     mov    <span class="va">$0</span>x5,%rdi</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000401007</span> <span class="op">&lt;</span>+7<span class="op">&gt;</span>:     mov    <span class="va">$0</span>x7,%rsi</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040100e</span> <span class="op">&lt;</span>+14<span class="op">&gt;</span>:    call   0x40101f <span class="op">&lt;</span>sum<span class="op">&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000401013</span> <span class="op">&lt;</span>+19<span class="op">&gt;</span>:    mov    <span class="va">$0</span>x3c,%rax</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040101a</span> <span class="op">&lt;</span>+26<span class="op">&gt;</span>:    xor    %rdi,%rdi</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000040101d</span> <span class="op">&lt;</span>+29<span class="op">&gt;</span>:    syscall</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">while</span> <span class="ex">1</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> x/4gx <span class="va">$rsp</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> x/i <span class="va">$rip</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> stepi</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> end</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe700:</span> 0x0000000000000001      0x00007fffffffe9ab</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe710:</span> 0x0000000000000000      0x00007fffffffe9bc</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x40100e <span class="op">&lt;</span>_start+14<span class="op">&gt;</span>:        call   0x40101f <span class="op">&lt;</span>sum<span class="op">&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe6f8:</span> 0x0000000000401013      0x0000000000000001</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe708:</span> 0x00007fffffffe9ab      0x0000000000000000</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="ex">=</span><span class="op">&gt;</span> 0x401025 <span class="op">&lt;</span>sum+6<span class="op">&gt;</span>:    ret    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe700:</span> 0x0000000000000001      0x00007fffffffe9ab</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe710:</span> 0x0000000000000000      0x00007fffffffe9bc</span></code></pre></div>
</div>
</div>
<p>Changes of the stack.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>┌───────────────┬───────────────────┐        ┌───────────────┬───────────────────┐        ┌───────────────┬───────────────────┐</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>│   address     │       value       │        │   address     │       value       │        │   address     │       value       │</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>├───────────────┼───────────────────┤        ├───────────────┼───────────────────┤        ├───────────────┼───────────────────┤</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>│               │                   │        │               │                   │        │               │                   │</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>│               │                   │ call   │               │                   │ ret    │               │                   │</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>│               │                   │ ─────► │<span class="bn">0x7fffffffe6f8</span> │ <span class="bn">0x0000000000401013</span>│ ─────► │               │                   │</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│        │<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│        │<span class="bn">0x7fffffffe700</span> │ <span class="bn">0x0000000000000001</span>│</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│        │<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│        │<span class="bn">0x7fffffffe708</span> │ <span class="bn">0x00007fffffffe9ab</span>│</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│        │<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│        │<span class="bn">0x7fffffffe710</span> │ <span class="bn">0x0000000000000000</span>│</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>│<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│        │<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│        │<span class="bn">0x7fffffffe718</span> │ <span class="bn">0x00007fffffffe9bc</span>│</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>└───────────────┴───────────────────┘        └───────────────┴───────────────────┘        └───────────────┴───────────────────┘</span></code></pre></div>
<ul>
<li>The call instruction pushes $rip 0x0000000000401013 to the stack,
and jump to the sum function.</li>
<li>The ret instruction pops 0x0000000000401013 from the stack, and then
jump to this address.</li>
</ul>
<h2 id="base-pointer">1.2. Base Pointer</h2>
<p>The base pointer (rbp) stores the start address of the function stack
frame. It remains fixed throughout the function, allowing compiler to
use its stable position to generate offsets for local variables and
parameter.</p>
<h3 id="prolog-epilog">1.2.1. Prolog &amp; Epilog</h3>
<div class="columns">
<div class="column" style="width:40%;">
<p>When calling a new C/C++ function, prolog is the compiler-generated
code that sets up the stack frame for the new function.</p>
<p>When leaving a C/C++ function, epilog is the compiler-generated code
that restores the parent’s stack frame and jump back to parent
function.</p>
<p>Example: parent_func calls child_func.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>parent_func<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    child_func<span class="op">()</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>child_func<span class="op">()</span> <span class="op">{</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div><div class="column" style="width:60%;">
<div class="sourceCode" id="cb14"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>&lt;parent_func<span class="op">&gt;:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">call</span>    child_func  <span class="op">#</span> save parent next instruction address <span class="op">(</span>rip<span class="op">)</span> to stack<span class="op">,</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                    # jump to child_func<span class="op">.</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>&lt;child_func<span class="op">&gt;:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                    # prolog</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">push</span>   <span class="op">%</span><span class="kw">rbp</span>         <span class="op">#</span> save parent base pointer <span class="op">(</span><span class="kw">rbp</span><span class="op">)</span> to stack<span class="op">.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">mov</span>    <span class="op">%</span><span class="kw">rsp</span><span class="op">,</span> <span class="op">%</span><span class="kw">rbp</span>   <span class="op">#</span> move current base pointer to top of stack <span class="op">(</span><span class="kw">rsp</span><span class="op">).</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>...                 # function body</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                    # epilog</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">pop</span>    <span class="op">%</span><span class="kw">rbp</span>         <span class="op">#</span> restore parent base pointer from stack<span class="op">.</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="cf">ret</span>                 <span class="op">#</span> restore parent next instruction address from stack<span class="op">,</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                    # jump to this instruction <span class="op">(</span>parent_func<span class="op">).</span></span></code></pre></div>
</div>
</div>
<p>Changes of the stack on prolog and epilog.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>        ┌───────────┐              ┌───────────┐             ┌───────────┐             ┌───────────┐</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>        │   stack   │              │   stack   │             │   stack   │             │   stack   │</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>$rbp ─┐ ├───────────┤              ├───────────┤    $rbp ─┐  ├───────────┤    $rbp ──┐ ├───────────┤</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>      │ │           │              │           │          │  │           │           │ │           │</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>      │ │           │              │           │          │  │           │           │ │           │</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      │ │           │              │           │          │  │           │           │ │           │</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>      │ │           │  parent_func │           │          └─►│parent $rbp│           │ │           │</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>      │ │           │  call        │parent $rip│             │parent $rip│           │ │           │</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      └─┼►          │  child_func  │           │   prolog    │           │  epilog   └─┼►          │</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        │           │ ───────────► │           │ ──────────► │           │ ──────────► │           │</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        └───────────┘              └───────────┘             └───────────┘             └───────────┘</span></code></pre></div>
<h3 id="arguments-local-variables">1.2.2. Arguments &amp; Local
Variables</h3>
<p>Local variables locates on the stack for each function call. Their
addresses are based on negative offsets from the base pointer rbp.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span></code></pre></div>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb18"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>movl   <span class="op">$</span><span class="bn">0</span>x1<span class="op">,-</span><span class="bn">0xc</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">)</span>  <span class="co">; a at $rbp-0xc</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>movl   <span class="op">$</span><span class="bn">0</span>x2<span class="op">,-</span><span class="bn">0x8</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">)</span>  <span class="co">; b at $rbp-0x8</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>movl   <span class="op">$</span><span class="bn">0</span>x3<span class="op">,-</span><span class="bn">0x4</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">)</span>  <span class="co">; c at $rbp-0x4</span></span></code></pre></div>
</div>
</div>
<p>When the parent function calls the child function, the arguments are
saved in the registers rdi, rsi, rdx, rcx, r8, and r9. If more than 6
arguments, the extra arguments are saved on the stack.<br />
Inside the child function, it reads the registers and saves the
arguments into its stack frame. The argument addresses in the stack
frame are based on the base pointer rbp.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>parent_function<span class="op">()</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    child_func<span class="op">(</span>a<span class="op">,</span> b<span class="op">);</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> child_func<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb20"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>&lt;parent_function<span class="op">&gt;:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">mov</span>    <span class="op">-</span><span class="bn">0x8</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">),%</span><span class="kw">esi</span>    <span class="op">#</span> save a to <span class="op">$</span>esi</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">mov</span>    <span class="op">-</span><span class="bn">0xc</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">),%</span><span class="kw">edi</span>    <span class="op">#</span> save b to <span class="op">$</span>edi</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">call</span>   child_func</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>&lt;child_func<span class="op">&gt;:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">mov</span>    <span class="op">%</span><span class="kw">edi</span><span class="op">,-</span><span class="bn">0x14</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">)</span>   <span class="op">#</span> save <span class="op">$</span>edi to stack<span class="op">,</span> b</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">mov</span>    <span class="op">%</span><span class="kw">esi</span><span class="op">,-</span><span class="bn">0x18</span><span class="op">(%</span><span class="kw">rbp</span><span class="op">)</span>   <span class="op">#</span> save <span class="op">$</span>esi to stack<span class="op">,</span> a</span></code></pre></div>
</div>
</div>
<h2 id="examine-stack-frame">1.3. Examine Stack Frame</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>The call instruction pushes the parent $rip onto the stack. The
function prologue pushes the parent $rip onto the stack. Function
arguments and local variables are stored in the stack, and their
addresses are based on the current RBP.</p>
<p>As you can see in the figure:</p>
<ul>
<li>From current $rbp, go backward to lower addresses, we reach the
local variables and arguments.</li>
<li>From current $rbp, go forward to higher addresses, we reach the
parent $rbp and $rip.</li>
</ul>
<p>So, in GDB:</p>
<ul>
<li>To examine arguments and local variables, examine backward from RBP,
eg: <code>x/-6wx $rbp</code>.</li>
<li>To examine the parent’s RBP and RIP, examine forward from RBP:
<code>x/2a $rbp</code>.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="sourceCode" id="cb21"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>───low address  ┌────────────────┐</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                │     stack      │</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                ├────────────────┤</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                │                │</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                │ <span class="op">...</span>            │</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                │ argument       │</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                │ argument       │</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                │ <span class="op">...</span>            │</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                │ local variable │</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                │ local variable │</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>      $rbp ───► │ parent $rbp    │</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                │ parent <span class="op">%</span>rip    │</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                │                │</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>──high address  └────────────────┘</span></code></pre></div>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p>File main.c</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> argv1<span class="op">,</span> <span class="dt">int</span> argv2<span class="op">)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="bn">0xaaaaaaaa</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b <span class="op">=</span> <span class="bn">0xbbbbbbbb</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c <span class="op">=</span> <span class="bn">0xcccccccc</span><span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> d <span class="op">=</span> <span class="bn">0xdddddddd</span><span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">**</span> argv<span class="op">)</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    func<span class="op">(</span><span class="bn">0x11111111</span><span class="op">,</span> <span class="bn">0x22222222</span><span class="op">);</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gcc main.c <span class="at">-o</span> main</span></code></pre></div>
<p>Run under GDB.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="fu">file</span> main</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">disassemble</span> func</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001129</span> <span class="op">&lt;</span>+0<span class="op">&gt;</span>:     endbr64 </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000000112d</span> <span class="op">&lt;</span>+4<span class="op">&gt;</span>:     push   %rbp</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000000112e</span> <span class="op">&lt;</span>+5<span class="op">&gt;</span>:     mov    %rsp,%rbp</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001131</span> <span class="op">&lt;</span>+8<span class="op">&gt;</span>:     mov    %edi,-0x14<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001134</span> <span class="op">&lt;</span>+11<span class="op">&gt;</span>:    mov    %esi,-0x18<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001137</span> <span class="op">&lt;</span>+14<span class="op">&gt;</span>:    movl   <span class="va">$0</span>xaaaaaaaa,-0x10<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000000113e</span> <span class="op">&lt;</span>+21<span class="op">&gt;</span>:    movl   <span class="va">$0</span>xbbbbbbbb,-0xc<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001145</span> <span class="op">&lt;</span>+28<span class="op">&gt;</span>:    movl   <span class="va">$0</span>xcccccccc,-0x8<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x000000000000114c</span> <span class="op">&lt;</span>+35<span class="op">&gt;</span>:    movl   <span class="va">$0</span>xdddddddd,-0x4<span class="er">(</span><span class="ex">%rbp</span><span class="kw">)</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001153</span> <span class="op">&lt;</span>+42<span class="op">&gt;</span>:    mov    <span class="va">$0</span>x0,%eax</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001158</span> <span class="op">&lt;</span>+47<span class="op">&gt;</span>:    pop    %rbp</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>   <span class="ex">0x0000000000001159</span> <span class="op">&lt;</span>+48<span class="op">&gt;</span>:    ret</span></code></pre></div>
</div><div class="column" style="width:50%;">
<p>Set breakpoint at the end of func.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="cf">break</span> <span class="ex">*func+42</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">run</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Breakpoint</span> 1, 0x0000555555555153 in func <span class="er">(</span><span class="kw">)</span></span></code></pre></div>
<p>Examine arguments and local variables.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/-6wx</span> <span class="va">$rbp</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe5d0:</span> 0xffffe5f0      0x00007fff      0x5555517c      0x00005555</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe5e0:</span> 0xffffe708      0x00007fff</span></code></pre></div>
<p>Examine parent’s $rip and $rbp.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/2a</span> <span class="va">$rbp</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0x7fffffffe5d0:</span> 0x7fffffffe5f0  0x55555555517c <span class="op">&lt;</span>main+34<span class="op">&gt;</span></span></code></pre></div>
<p>Illustrate the stack.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode go"><code class="sourceCode go"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>                         ┌────────────────┐               </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                         │     stack      │               </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>          ───low address ├────────────────┤               </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>                         │                │               </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x7fffffffe5b8</span> │ <span class="bn">0x22222222</span>     │ argument argv2</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                         │ <span class="bn">0x11111111</span>     │ argument argv2</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                         │ <span class="bn">0xaaaaaaaa</span>     │ variable a    </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                         │ <span class="bn">0xbbbbbbbb</span>     │ variable b    </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>          <span class="bn">0x7fffffffe5c8</span> │ <span class="bn">0xcccccccc</span>     │ variable c    </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                         │ <span class="bn">0xdddddddd</span>     │ variable d    </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>$rbp ───► <span class="bn">0x7fffffffe5d0</span> │ <span class="bn">0x7fffffffe5f0</span> │ parent $rbp   </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                         │ <span class="bn">0x55555555517c</span> │ parent $rip   </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                         │                │               </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>          ──high address └────────────────┘               </span></code></pre></div>
</div>
</div>
<h1 id="gdb">GDB</h1>
<h2 id="find-memory">Find Memory</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>Search memory for the sequence of bytes.</p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">find</span> <span class="pp">[</span><span class="ss">/sn</span><span class="pp">]</span> start_addr, +len, vals...</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">find</span> <span class="pp">[</span><span class="ss">/sn</span><span class="pp">]</span> start_addr, end_addr, vals...</span></code></pre></div>
<ul>
<li><em>+len</em>: number of bytes to search.</li>
<li><em>s</em>: size of each search query value (b, h, w, g).</li>
<li><em>n</em>: number of matches to print.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">char</span> str<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;hello-hello&quot;</span><span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">short</span> a <span class="op">=</span> <span class="bn">0x0102</span><span class="op">;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> b <span class="op">=</span> <span class="bn">0x0a0b0c0d</span><span class="op">;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find str</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">&amp;</span><span class="bu">str</span>, <span class="op">+</span>sizeof(<span class="bu">str</span>), <span class="st">&quot;hello&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">&amp;</span><span class="bu">str</span>, <span class="op">+</span>sizeof(<span class="bu">str</span>), <span class="st">&#39;h&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;l&#39;</span>, <span class="st">&#39;l&#39;</span>, <span class="st">&#39;o&#39;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># find a</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">&amp;</span>a, <span class="op">+</span><span class="dv">2</span>, (short)<span class="bn">0x0102</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">/</span>h <span class="op">&amp;</span>a, <span class="op">+</span><span class="dv">2</span>, <span class="bn">0x0102</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">/</span>b <span class="op">&amp;</span>a, <span class="op">+</span><span class="dv">2</span>, <span class="bn">0x02</span>, <span class="bn">0x01</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># find b</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">&amp;</span>b, <span class="op">+</span><span class="dv">4</span>, (<span class="bu">int</span>)<span class="bn">0x0a0b0c0d</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">/</span>w <span class="op">&amp;</span>b, <span class="op">+</span><span class="dv">4</span>, <span class="bn">0x0a0b0c0d</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># find b, a</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                  (int)b         , padding      , (short)a</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>(gdb) find <span class="op">&amp;</span>b, <span class="op">+</span><span class="dv">8</span>, (<span class="bu">int</span>)<span class="bn">0x0a0b0c0d</span>, (short)<span class="bn">0x0000</span>, (short)<span class="bn">0x0102</span></span></code></pre></div>
<p><br></p>
<h2 id="export-memory">Export Memory</h2>
<p>Dump the contents of memory from start_addr to end_addr, or the value
of expr, to file.</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">dump</span> <span class="pp">[</span><span class="ss">format</span><span class="pp">]</span> memory filename start_addr end_addr</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">dump</span> <span class="pp">[</span><span class="ss">format</span><span class="pp">]</span> value filename expr</span></code></pre></div>
<ul>
<li><em>format</em>: binary, ihex, srec, tekhex, verilog.</li>
</ul>
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="op">&amp;</span><span class="bu">str</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>$<span class="dv">3</span> <span class="op">=</span> (char (<span class="op">*</span>)[<span class="dv">12</span>]) <span class="bn">0xffffffffec88</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>(gdb) dump memory mem.<span class="bu">hex</span> <span class="bn">0xffffffffec88</span> <span class="bn">0xffffffffec88</span><span class="op">+</span><span class="dv">12</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>(gdb) dump value val.<span class="bu">hex</span> <span class="bu">str</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>$ hexdump <span class="op">-</span>C mem.<span class="bu">hex</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="dv">00000000</span>  <span class="dv">68</span> <span class="dv">65</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">2</span><span class="er">d</span> <span class="dv">68</span> <span class="dv">65</span>  <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">00</span>              <span class="op">|</span>hello<span class="op">-</span>hello.<span class="op">|</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>$ hexdump <span class="op">-</span>C val.<span class="bu">hex</span> </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="dv">00000000</span>  <span class="dv">68</span> <span class="dv">65</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">2</span><span class="er">d</span> <span class="dv">68</span> <span class="dv">65</span>  <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">c</span> <span class="dv">6</span><span class="er">f</span> <span class="dv">00</span>              <span class="op">|</span>hello<span class="op">-</span>hello.<span class="op">|</span></span></code></pre></div>
<p><br></p>
<h2 id="import-memory">Import Memory</h2>
<p>Restore the contents of file filename into memory.</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">restore</span> file <span class="pp">[</span><span class="ss">binary</span><span class="pp">]</span> offset start end</span></code></pre></div>
<ul>
<li><em>binary</em>: when file format is raw binary.</li>
<li><em>offset</em>: starting offset in file, default 0.</li>
<li><em>start</em>: starting address in target memory.</li>
<li><em>end</em>: ending address in target memory.</li>
</ul>
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(gdb) p <span class="op">&amp;</span><span class="bu">str</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>$<span class="dv">3</span> <span class="op">=</span> (char (<span class="op">*</span>)[<span class="dv">12</span>]) <span class="bn">0xffffffffec88</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#             file           start</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>(gdb) restore mem.<span class="bu">hex</span> binary <span class="bn">0xffffffffec88</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>Restoring binary <span class="bu">file</span> mem.<span class="bu">hex</span> into memory (<span class="bn">0xffffffffec88</span> to <span class="bn">0xffffffffec94</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#             file           offset     start</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>(gdb) restore mem.<span class="bu">hex</span> binary <span class="dv">0</span>          <span class="bn">0xffffffffec88</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>Start address <span class="kw">is</span> greater than length of binary <span class="bu">file</span> mem.<span class="bu">hex</span>.</span></code></pre></div>
<p><br></p>
<h2 id="memory-regions">Memory Regions</h2>
<p>List memory regions.</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">info</span> proc mapping</span></code></pre></div>
<p><br></p>
<p>Sample: Add a memory region by gdb.</p>
<div class="columns">
<div class="column">
<ul>
<li>main.c</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div><div class="column">
<ul>
<li>hello.txt</li>
</ul>
<div class="sourceCode" id="cb38"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="ex">hello</span> world</span></code></pre></div>
</div>
</div>
<ul>
<li>GDB session.</li>
</ul>
<div class="sourceCode" id="cb39"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="bu">set</span> <span class="va">$fd</span> = <span class="er">(</span><span class="ex">int</span><span class="kw">)</span> <span class="ex">open</span><span class="er">(</span><span class="st">&quot;hello.txt&quot;</span><span class="ex">,</span> 0<span class="kw">)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="bu">set</span> <span class="va">$region_addr</span> = <span class="er">(</span><span class="ex">void*</span><span class="kw">)</span> <span class="ex">mmap</span><span class="er">(</span><span class="ex">0,</span> 4096, 1, 1, <span class="va">$fd</span>, 0<span class="kw">)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">info</span> proc mappings</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Start</span> Addr         End Addr           Size    Offset  Perms File </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="ex">0x0000fffff7ff5000</span> 0x0000fffff7ff6000 0x1000  0x0     r--s  /root/demo/hello.txt </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">gdb</span><span class="kw">)</span> <span class="ex">x/s</span> <span class="va">$region_addr</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="ex">0xfffff7ff5000:</span> <span class="st">&quot;hello world\n&quot;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>    </span></code></pre></div>
<p><br></p>
<h2 id="core-dump">Core Dump</h2>
<p>Generate the core dump.</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>  <span class="ex">gcore</span> <span class="pp">[</span><span class="ss">file</span><span class="pp">]</span></span></code></pre></div>
<ul>
<li>file: if file not specified, the file name defaults to core.pid,
where pid is the inferior process ID.</li>
</ul>
<p>Load the core dump.</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gdb</span> program core</span></code></pre></div>
<footer class="footer text-muted">
   <div align="center">
      <a href="/index.html"><b>Home</b></a>
   </div>
 </footer>
</body>
</html>
